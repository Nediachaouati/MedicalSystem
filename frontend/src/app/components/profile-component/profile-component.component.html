<app-navbar></app-navbar>
<div class="profile-container">
  <app-sidebar></app-sidebar>

  <div class="profile-card">
    <h1>Mon Profil</h1>

    <!-- ALERTES MODERNES -->
    <div *ngIf="successMessage" class="alert alert-success">
      <i class="fas fa-check-circle"></i> {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-danger">
      <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
    </div>

    <div *ngIf="user; else loading">
      <form (ngSubmit)="updateProfile()" class="profile-form">
        
        <!-- PHOTO -->
        <div class="form-group photo-group">
          <div class="photo-wrapper">
            <img
              [src]="getPhotoUrl(profileForm.photo)"
              alt="Photo de profil"
              class="profile-img"
            />
            <label for="photo" class="photo-upload">
              <i class="fas fa-camera"></i>
            </label>
          </div>
          <input
            type="file"
            id="photo"
            accept="image/*"
            (change)="onFileSelected($event)"
            hidden
          />
        </div>

        <!-- CHAMPS -->
        <div class="form-row">
          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="profileForm.email" name="email" required />
          </div>
          <div class="form-group">
            <label>Nom complet</label>
            <input type="text" [(ngModel)]="profileForm.name" name="name" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Téléphone</label>
            <input type="tel" [(ngModel)]="profileForm.phoneNumber" name="phoneNumber" />
          </div>
          <div class="form-group">
            <label>Adresse</label>
            <input type="text" [(ngModel)]="profileForm.address" name="address" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Date de naissance</label>
            <input type="date" [(ngModel)]="profileForm.birthDate" name="birthDate" />
          </div>
          <div class="form-group" *ngIf="user.role === role.MEDECIN">
            <label>Spécialité</label>
            <input type="text" [(ngModel)]="profileForm.speciality" name="speciality" />
          </div>
        </div>

        <button type="submit" class="btn-submit">
          Mettre à jour le profil
        </button>
      </form>
    </div>

    <ng-template #loading>
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i> Chargement...
      </div>
    </ng-template>
  </div>
</div>
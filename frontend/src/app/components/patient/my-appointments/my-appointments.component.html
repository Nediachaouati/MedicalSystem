<app-navbar></app-navbar>
<div class="dashboard-wrapper">
  <app-sidebar></app-sidebar>
  <div class="main-content">
    <div class="container">
      <h1>Mes Rendez-vous</h1>
      <p>Liste de vos rendez-vous.</p>
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>
      <table class="table table-striped" *ngIf="appointments.length > 0; else noAppointments">
        <thead>
          <tr>
            <th>#</th>
            <th>Médecin</th>
            <th>Date</th>
            <th>Heure</th>
            <th>Symptômes</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let appointment of appointments; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ appointment.doctorName || 'Médecin inconnu' }}</td>
            <td>{{ appointment.date | date: 'dd/MM/yyyy' }}</td>
            <td>{{ appointment.time }}</td>
            <td>
              <span *ngIf="appointment.symptoms && appointment.symptoms.length > 0">
                {{ appointment.symptoms[0].description }} (Intensité: {{ appointment.symptoms[0].intensity }}/10)
                <span *ngIf="appointment.symptoms.length > 1">...</span>
              </span>
              <span *ngIf="!appointment.symptoms || appointment.symptoms.length === 0">
                Aucun symptôme
              </span>
            </td>
            <td>
              <span [ngClass]="{
                'status-pending': appointment.appointmentStatus === 'en_attente',
                'status-confirmed': appointment.appointmentStatus === 'approuvé',
                'status-rejected': appointment.appointmentStatus === 'annulé'
              }">
                {{ appointment.appointmentStatus === 'en_attente' ? 'En attente' : appointment.appointmentStatus === 'approuvé' ? 'Approuvé' : 'Annulé' }}
              </span>
            </td>
            <td>
              <button *ngIf="appointment.consultationStatus === 'terminée' && appointment.prescriptions && appointment.prescriptions.length > 0" 
                      class="btn btn-info btn-sm" 
                      (click)="downloadPrescriptionPdf(appointment.id)">
                Télécharger ordonnance
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <ng-template #noAppointments>
        <p>Aucun rendez-vous trouvé.</p>
      </ng-template>
    </div>
  </div>
</div>
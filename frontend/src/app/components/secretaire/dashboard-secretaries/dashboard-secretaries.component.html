<app-navbar></app-navbar>
<div class="dashboard-wrapper">
  <app-sidebar></app-sidebar>

  <div class="main-content">
    <!-- EN-TÊTE -->
    <div class="page-header">
      <h1>Rendez-vous</h1>
     
    </div>

    <!-- MESSAGES -->
    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>

    <!-- TABLEAU -->
    <div class="table-container" *ngIf="appointments.length > 0; else noAppointments">
      <table class="modern-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Patient</th>
            <th>Date</th>
            <th>Heure</th>
            <th>Symptômes</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let appointment of appointments; let i = index">
            <td>{{ i + 1 }}</td>
            <td><strong>{{ appointment.patientName || 'Patient inconnu' }}</strong></td>
            <td>{{ appointment.date | date: 'dd/MM/yyyy' }}</td>
            <td>
              <span class="time-badge">{{ appointment.time }}</span>
            </td>
            <td>
              <span *ngIf="appointment.symptoms?.length" class="symptom-tag">
                {{ appointment.symptoms[0].description }}
                <small>({{ appointment.symptoms[0].intensity }}/10)</small>
              </span>
              <span *ngIf="!appointment.symptoms?.length" class="text-muted">Aucun</span>
            </td>

            <!-- STATUT -->
            <td>
              <span class="status-badge"
                    [ngClass]="{
                      'status-pending': appointment.appointmentStatus === 'en_attente',
                      'status-approved': appointment.appointmentStatus === 'approuvé',
                      'status-canceled': appointment.appointmentStatus === 'annulé'
                    }">
                {{ appointment.appointmentStatus === 'en_attente' ? 'En attente' :
                   appointment.appointmentStatus === 'approuvé' ? 'Approuvé' : 'Annulé' }}
              </span>
            </td>

            <!-- ACTIONS : Approuver / Annuler -->
            <td class="actions">
              <ng-container *ngIf="appointment.appointmentStatus === 'en_attente'">
                <button class="btn-action btn-approve" (click)="confirmAppointment(appointment.id)">
                  Approuver
                </button>
                <button class="btn-action btn-cancel" (click)="cancelAppointment(appointment.id)">
                  Annuler
                </button>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- AUCUN RDV -->
    <ng-template #noAppointments>
      <div class="empty-state">
        <p>Aucun rendez-vous trouvé.</p>
      </div>
    </ng-template>
  </div>
</div>